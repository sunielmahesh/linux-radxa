// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2019 Fuzhou Rockchip Electronics Co., Ltd
 * Copyright (c) 2019 Radxa Limited
 * Copyright (c) 2019 Amarula Solutions(India)
 */

/dts-v1/;
#include "rk3399.dtsi"
#include "rk3399-opp.dtsi"
#include "rk3399pro-vmarc-som.dtsi"
#include <arm/rockchip-radxa-dalang-carrier.dtsi>

/ {
	model = "Radxa ROCK Pi N10";
	compatible = "radxa,rockpi-n10", "vamrs,rk3399pro-vmarc-som",
		     "rockchip,rk3399pro";

	sdio_pwrseq: sdio-pwrseq {
                status = "okay";
                compatible = "mmc-pwrseq-simple";
                clocks = <&hym8563>;
                clock-names = "ext_clock";
                pinctrl-names = "default";
                pinctrl-0 = <&wifi_enable_h>;

                /*
                 * On the module itself this is one of these (depending
                 * on the actual card populated):
                 * - SDIO_RESET_L_WL_REG_ON
                 * - PDN (power down when low)
                 */
                reset-gpios = <&gpio2 RK_PD3 GPIO_ACTIVE_LOW>;
        };
};

&sdio0 {
        #address-cells = <1>;
        #size-cells = <0>;
        bus-width = <4>;
        clock-frequency = <50000000>;
        cap-sdio-irq;
        cap-sd-highspeed;
        keep-power-in-suspend;
        mmc-pwrseq = <&sdio_pwrseq>;
        non-removable;
        pinctrl-names = "default";
        pinctrl-0 = <&sdio0_bus4 &sdio0_cmd &sdio0_clk>;
        sd-uhs-sdr104;
        status = "okay";

        brcmf: wifi@1 {
                compatible = "brcm,bcm4329-fmac";
                reg = <1>;
                interrupt-parent = <&gpio0>;
                interrupts = <RK_PA3 GPIO_ACTIVE_HIGH>;
                interrupt-names = "host-wake";
                pinctrl-names = "default";
                pinctrl-0 = <&wifi_host_wake_l>;
        };
};

&uart0 {
        pinctrl-names = "default";
        pinctrl-0 = <&uart0_xfer &uart0_cts &uart0_rts>;
        status = "okay";

        bluetooth {
                compatible = "brcm,bcm43438-bt";
                clocks = <&hym8563>;
                clock-names = "ext_clock";
                device-wakeup-gpios = <&gpio2 RK_PD2 GPIO_ACTIVE_HIGH>;
		host-wakeup-gpios = <&gpio0 RK_PA5 GPIO_ACTIVE_HIGH>;
                shutdown-gpios = <&gpio2 RK_PD4 GPIO_ACTIVE_HIGH>;
                pinctrl-names = "default";
                pinctrl-0 = <&bt_host_wake_l &bt_wake_l &bt_enable_h>;
        };
};

&pinctrl {
	sdio-pwrseq {
                wifi_enable_h: wifi-enable-h {
                        rockchip,pins =
                                <2 RK_PD3 0 &pcfg_pull_none>;
                };
        };

	sdio0 {
                sdio0_bus4: sdio0-bus4 {
                        rockchip,pins =
                                <2 RK_PC4 1 &pcfg_pull_up_20ma>,
                                <2 RK_PC5 1 &pcfg_pull_up_20ma>,
                                <2 RK_PC6 1 &pcfg_pull_up_20ma>,
                                <2 RK_PC7 1 &pcfg_pull_up_20ma>;
                };

                sdio0_cmd: sdio0-cmd {
                        rockchip,pins =
                                <2 RK_PD0 1 &pcfg_pull_up_20ma>;
                };

		sdio0_clk: sdio0-clk {
                        rockchip,pins =
                                <2 RK_PD1 1 &pcfg_pull_none_20ma>;
		};
	};

	wifi {
                wifi_host_wake_l: wifi-host-wake-l {
                        rockchip,pins = <0 RK_PA3 RK_FUNC_GPIO &pcfg_pull_none>;
                };
        };

	bt {
                bt_enable_h: bt-enable-h {
                        rockchip,pins = <2 RK_PD4 RK_FUNC_GPIO &pcfg_pull_none>;
                };

                bt_host_wake_l: bt-host-wake-l {
                        rockchip,pins = <0 RK_PA5 RK_FUNC_GPIO &pcfg_pull_none>;
                };

                bt_wake_l: bt-wake-l {
                        rockchip,pins = <2 RK_PD2 RK_FUNC_GPIO &pcfg_pull_none>;
                };
        };
};
